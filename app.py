import streamlit as st
from collections import Counter

# ===============================
# í•œê¸€ ë¶„í•´ í…Œì´ë¸”
# ===============================

CHOSUNG = [
    "ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……",
    "ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"
]

JUNGSUNG = [
    "ã…","ã…","ã…‘","ã…’","ã…“","ã…”","ã…•","ã…–",
    "ã…—","ã…˜","ã…™","ã…š","ã…›",
    "ã…œ","ã…","ã…","ã…Ÿ","ã… ",
    "ã…¡","ã…¢","ã…£"
]

JONGSUNG = [
    "", "ã„±","ã„²","ã„³","ã„´","ã„µ","ã„¶","ã„·","ã„¹","ã„º","ã„»",
    "ã„¼","ã„½","ã„¾","ã„¿","ã…€","ã…","ã…‚","ã…„","ã……","ã…†",
    "ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"
]

# ===============================
# ììŒ ë¶„í•´ ê·œì¹™
# ===============================

DOUBLE_CONSONANT = {
    "ã„²": ["ã„±","ã„±"],
    "ã„¸": ["ã„·","ã„·"],
    "ã…ƒ": ["ã…‚","ã…‚"],
    "ã…†": ["ã……","ã……"],
    "ã…‰": ["ã…ˆ","ã…ˆ"]
}

DOUBLE_JONG = {
    "ã„³": ["ã„±","ã……"],
    "ã„µ": ["ã„´","ã…ˆ"],
    "ã„¶": ["ã„´","ã…"],
    "ã„º": ["ã„¹","ã„±"],
    "ã„»": ["ã„¹","ã…"],
    "ã„¼": ["ã„¹","ã…‚"],
    "ã„½": ["ã„¹","ã……"],
    "ã„¾": ["ã„¹","ã…Œ"],
    "ã„¿": ["ã„¹","ã…"],
    "ã…€": ["ã„¹","ã…"],
    "ã…„": ["ã…‚","ã……"]
}

# ===============================
# â­ ìµœì¢… ëª¨ìŒ ë¶„í•´ ê·œì¹™ (í—Œë²•)
# ===============================

VOWEL_RULE = {
    # ê¸°ë³¸ ëª¨ìŒ
    "ã…£": ["ã…£"],
    "ã…": ["ã…"],
    "ã…‘": ["ã…‘"],
    "ã…": ["ã…"],
    "ã…”": ["ã…”"],
    "ã…–": ["ã…–"],

    # ë³€í˜•
    "ã…“": ["ã…"],
    "ã…—": ["ã…"],
    "ã…œ": ["ã…"],
    "ã…•": ["ã…‘"],
    "ã…›": ["ã…‘"],
    "ã… ": ["ã…‘"],
    "ã…¡": ["ã…£"],
    "ã…’": ["ã…"],

    # ë³µí•©
    "ã…¢": ["ã…£","ã…£"],
    "ã…š": ["ã…","ã…£"],
    "ã…Ÿ": ["ã…","ã…£"],

    # ì¶”ê°€ ì •ì˜
    "ã…˜": ["ã…","ã…"],
    "ã…™": ["ã…","ã…"],
    "ã…": ["ã…","ã…"],
    "ã…": ["ã…","ã…”"]
}

# ===============================
# í•œê¸€ ë¶„í•´ í•¨ìˆ˜
# ===============================

def decompose_hangul(char):
    result = []

    # ìëª¨ ë‹¨ë… ì…ë ¥
    if char in DOUBLE_CONSONANT:
        return DOUBLE_CONSONANT[char]

    if char in DOUBLE_JONG:
        return DOUBLE_JONG[char]

    if char in VOWEL_RULE:
        return VOWEL_RULE[char]

    # ì™„ì„±í˜• í•œê¸€
    code = ord(char) - 0xAC00
    if code < 0 or code > 11171:
        return [char]

    cho = code // 588
    jung = (code % 588) // 28
    jong = code % 28

    # ì´ˆì„±
    c = CHOSUNG[cho]
    result.extend(DOUBLE_CONSONANT.get(c, [c]))

    # ì¤‘ì„±
    result.extend(VOWEL_RULE[JUNGSUNG[jung]])

    # ì¢…ì„±
    if jong != 0:
        j = JONGSUNG[jong]
        if j in DOUBLE_JONG:
            result.extend(DOUBLE_JONG[j])
        elif j in DOUBLE_CONSONANT:
            result.extend(DOUBLE_CONSONANT[j])
        else:
            result.append(j)

    return result

# ===============================
# ì¹´ìš´íŠ¸ ë¡œì§
# ===============================

def count_characters(text):
    counter = Counter()

    for char in text.replace(" ", ""):
        # ì˜ì–´
        if char.isalpha() and char.encode().isalpha():
            counter[char.upper()] += 1

        # í•œê¸€
        elif ("ê°€" <= char <= "í£") or char in CHOSUNG or char in JUNGSUNG:
            for p in decompose_hangul(char):
                counter[p] += 1

    return counter

# ===============================
# Streamlit UI
# ===============================

st.set_page_config(page_title="ì™€íœ ê¸€ì ê³„ì‚°ê¸°")

st.title("ì™€íœ ê¸€ì ê°œìˆ˜ ê³„ì‚°ê¸° by ì™€íœë§ˆì„ê°ì”¨")
st.write("í•œê¸€ Â· ì˜ì–´ ìƒê´€ì—†ì´ ì…ë ¥í•˜ë©´ ê¸€ì ê°œìˆ˜ë¥¼ ìë™ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤. ì…ë ¥í•˜ì‹œê³  ì—”í„°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš” :)")

text = st.text_input("ë‹¨ì–´ ë˜ëŠ” ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”")

if text:
    result = count_characters(text)
    st.subheader("ğŸ“Š ê³„ì‚° ê²°ê³¼")

    for k, v in sorted(result.items()):
        st.write(f"{k} : {v}ê°œ")
